<div class="container">
  <header class="page-header">
    <button class="back-button" (click)="goBack()">‚Üê Back</button>
    <h1 class="page-title">Keyword Details</h1>
  </header>

  <app-loading *ngIf="isLoading"></app-loading>

  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

  <div *ngIf="keywordDetail" class="keyword-details-section">
    <h2>Keyword: {{ keywordDetail.text }} <span class="status-badge {{ keywordDetail.status | lowercase }}">{{ keywordDetail.status }}</span></h2>
    <p>Uploaded At: {{ keywordDetail.createdAt | date:'short' }}</p>

    <h3>Scrape Attempts ({{ keywordDetail.scrapeAttempts.length }})</h3>
    <div class="attempts-list" @listAnimation>
      <div *ngFor="let attempt of keywordDetail.scrapeAttempts" class="attempt-item">
        <p>Status: <span class="status-badge {{ attempt.status | lowercase }}">{{ attempt.status }}</span></p>
        <p>Ads: {{ attempt.adCount }}</p>
        <p>Links: {{ attempt.linkCount }}</p>
        <p>Attempted At: {{ attempt.createdAt | date:'short' }}</p>
        <p *ngIf="attempt.error">Error: {{ attempt.error }}</p>
        <div class="attempt-actions" *ngIf="attempt.html">
          <div class="segmented-control">
            <button [class.active]="attempt.htmlDisplayMode === 'off'" (click)="setHtmlDisplayMode(attempt, 'off')">Hide</button>
            <button [class.active]="attempt.htmlDisplayMode === 'raw'" (click)="setHtmlDisplayMode(attempt, 'raw')">Raw</button>
            <button [class.active]="attempt.htmlDisplayMode === 'render'" (click)="setHtmlDisplayMode(attempt, 'render')">Render</button>
          </div>
        </div>
        <div *ngIf="attempt.htmlDisplayMode === 'raw' && attempt.html && !attempt.isHtmlLoading" class="html-viewer">
          <pre>{{ attempt.html }}</pre>
        </div>
        <div *ngIf="attempt.htmlDisplayMode === 'render' && attempt.html && !attempt.isHtmlLoading" class="html-viewer rendered-html">
          <div [innerHTML]="getSanitizedHtml(attempt.html)"></div>
        </div>
        <app-loading *ngIf="attempt.isHtmlLoading"></app-loading>
      </div>
      <div *ngIf="keywordDetail.scrapeAttempts.length === 0" class="no-attempts">
        No scrape attempts yet.
      </div>
    </div>
  </div>
</div>